{% extends "base.html" %}

{% block title %}Order Confirmation - Pavitra Enterprises{% endblock %}

{% block content %}
  <!-- Page Title -->
  <div class="page-title light-background">
    <div class="container d-lg-flex justify-content-between align-items-center">
      <h1 class="mb-2 mb-lg-0">Order Confirmation</h1>
      <nav class="breadcrumbs">
        <ol>
          <li><a href="{{ url_for('shop.index') }}">Home</a></li>
          <li class="current">Order Confirmation</li>
        </ol>
      </nav>
    </div>
  </div><!-- End Page Title -->

  <!-- Order Confirmation Section -->
  <section id="order-confirmation" class="order-confirmation section">

    <div class="container" data-aos="fade-up" data-aos-delay="100">

      <div class="order-confirmation-3">
        <div class="row g-0">
          <!-- Left sidebar with order summary -->
          <div class="col-lg-4 sidebar" data-aos="fade-right">
            <div class="sidebar-content">
              <!-- Success animation -->
              <div class="success-animation">
                <i class="bi bi-check-lg"></i>
              </div>

              <!-- Order number and date -->
              <div class="order-id">
                <h4>Order #{{ order.order_number }}</h4>
                <div class="order-date">{{ order.created_at.strftime('%B %d, %Y') if order.created_at else 'Today' }}</div>
              </div>

              <!-- Order progress stepper -->
              <div class="order-progress">
                <div class="stepper-container">
                  <div class="stepper-item completed">
                    <div class="stepper-icon">1</div>
                    <div class="stepper-text">Confirmed</div>
                  </div>
                  <div class="stepper-item {% if order.status != 'pending' %}completed{% else %}current{% endif %}">
                    <div class="stepper-icon">2</div>
                    <div class="stepper-text">Processing</div>
                  </div>
                  <div class="stepper-item {% if order.status == 'shipped' or order.status == 'delivered' %}completed{% endif %}">
                    <div class="stepper-icon">3</div>
                    <div class="stepper-text">Shipped</div>
                  </div>
                  <div class="stepper-item {% if order.status == 'delivered' %}completed{% endif %}">
                    <div class="stepper-icon">4</div>
                    <div class="stepper-text">Delivered</div>
                  </div>
                </div>
              </div>

              <!-- Price summary -->
              <div class="price-summary">
                <h5>Order Summary</h5>
                <ul class="summary-list">
                  <li>
                    <span>Subtotal</span>
                    <span>₹{{ "%.2f"|format(order.subtotal) }}</span>
                  </li>
                  <li>
                    <span>Shipping</span>
                    <span>
                      {% if order.shipping_amount == 0 %}
                        FREE
                      {% else %}
                        ₹{{ "%.2f"|format(order.shipping_amount) }}
                      {% endif %}
                    </span>
                  </li>
                  <li>
                    <span>Tax</span>
                    <span>₹{{ "%.2f"|format(order.tax_amount) }}</span>
                  </li>
                  <li class="total">
                    <span>Total</span>
                    <span>₹{{ "%.2f"|format(order.total_amount) }}</span>
                  </li>
                </ul>
              </div>

              <!-- Delivery info -->
              <div class="delivery-info">
                <h5>Delivery Information</h5>
                <p class="delivery-estimate">
                  <i class="bi bi-calendar-check"></i>
                  <span>Estimated delivery: 3-5 business days</span>
                </p>
                <p class="shipping-method">
                  <i class="bi bi-truck"></i>
                  <span>
                    {% if order.shipping_amount == 0 %}
                      Free Shipping
                    {% else %}
                      Standard Shipping
                    {% endif %}
                  </span>
                </p>
              </div>

              <!-- Customer service -->
              <div class="customer-service">
                <h5>Need Help?</h5>
                <a href="{{ url_for('shop.contact') }}" class="help-link">
                  <i class="bi bi-chat-dots"></i>
                  <span>Contact Support</span>
                </a>
                <a href="{{ url_for('shop.faq') }}" class="help-link">
                  <i class="bi bi-question-circle"></i>
                  <span>FAQs</span>
                </a>
              </div>
            </div>
          </div>

          <!-- Main content area -->
          <div class="col-lg-8 main-content" data-aos="fade-in">
            <!-- Thank you message -->
            <div class="thank-you-message">
              <h1>Thanks for your order!</h1>
              <p>We've received your order and will begin processing it right away.
                We'll send you updates via email as your order progresses.</p>
            </div>

            <!-- Shipping details -->
            <div class="details-card" data-aos="fade-up">
              <div class="card-header" data-toggle="collapse">
                <h3>
                  <i class="bi bi-geo-alt"></i>
                  Shipping Details
                </h3>
                <i class="bi bi-chevron-down toggle-icon"></i>
              </div>
              <div class="card-body">
                <div class="row g-4">
                  <div class="col-md-6">
                    <div class="detail-group">
                      <label>Ship To</label>
                      <address>
                        {{ order.shipping_address.full_name }}<br>
                        {{ order.shipping_address.address_line1 }}<br>
                        {% if order.shipping_address.address_line2 %}
                        {{ order.shipping_address.address_line2 }}<br>
                        {% endif %}
                        {% if order.shipping_address.landmark %}
                        Landmark: {{ order.shipping_address.landmark }}<br>
                        {% endif %}
                        {{ order.shipping_address.city }}, {{ order.shipping_address.state }} - {{ order.shipping_address.postal_code }}<br>
                        {{ order.shipping_address.country }}
                      </address>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="detail-group">
                      <label>Contact</label>
                      <div class="contact-info">
                        <p><i class="bi bi-telephone"></i> {{ order.shipping_address.country_code }} {{ order.shipping_address.phone }}</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Payment details -->
            <div class="details-card" data-aos="fade-up">
              <div class="card-header" data-toggle="collapse">
                <h3>
                  <i class="bi bi-credit-card"></i>
                  Payment Details
                </h3>
                <i class="bi bi-chevron-down toggle-icon"></i>
              </div>
              <div class="card-body">
                <div class="payment-method">
                  <div class="payment-icon">
                    {% if order.payment_method == 'cash_on_delivery' %}
                    <i class="bi bi-cash"></i>
                    {% elif order.payment_method == 'upi' %}
                    <i class="bi bi-phone"></i>
                    {% elif order.payment_method == 'credit_card' %}
                    <i class="bi bi-credit-card-2-front"></i>
                    {% elif order.payment_method == 'netbanking' %}
                    <i class="bi bi-bank"></i>
                    {% else %}
                    <i class="bi bi-credit-card"></i>
                    {% endif %}
                  </div>
                  <div class="payment-details">
                    <div class="card-type">
                      {% if order.payment_method == 'cash_on_delivery' %}
                      Cash on Delivery
                      {% elif order.payment_method == 'upi' %}
                      UPI Payment
                      {% elif order.payment_method == 'credit_card' %}
                      Credit/Debit Card
                      {% elif order.payment_method == 'netbanking' %}
                      Net Banking
                      {% else %}
                      {{ order.payment_method|replace('_', ' ')|title }}
                      {% endif %}
                    </div>
                    <div class="card-number">
                      {% if order.payment_method == 'cash_on_delivery' %}
                      Pay when you receive your order
                      {% else %}
                      Payment Status: {{ order.payment_status|title }}
                      {% endif %}
                    </div>
                  </div>
                </div>
                <div class="billing-address mt-4">
                  <h5>Billing Address</h5>
                  <p>
                    {{ order.billing_address.full_name }}<br>
                    {{ order.billing_address.address_line1 }}<br>
                    {% if order.billing_address.address_line2 %}
                    {{ order.billing_address.address_line2 }}<br>
                    {% endif %}
                    {{ order.billing_address.city }}, {{ order.billing_address.state }} - {{ order.billing_address.postal_code }}
                  </p>
                </div>
              </div>
            </div>

            <!-- Order items -->
            <div class="details-card" data-aos="fade-up">
              <div class="card-header" data-toggle="collapse">
                <h3>
                  <i class="bi bi-bag-check"></i>
                  Order Items
                </h3>
                <i class="bi bi-chevron-down toggle-icon"></i>
              </div>
              <div class="card-body">
                {% for item in order.items %}
                <div class="item">
                  <div class="item-image">
                    <img src="{{ item.product_image or url_for('static', filename='img/product/placeholder.jpg') }}"
                         alt="{{ item.product_name }}" loading="lazy" style="width: 80px; height: 80px; object-fit: cover;">
                  </div>
                  <div class="item-details">
                    <h4>{{ item.product_name }}</h4>
                    <div class="item-meta">
                      <span>SKU: {{ item.product_sku }}</span>
                    </div>
                    <div class="item-price">
                      <span class="quantity">{{ item.quantity }} ×</span>
                      <span class="price">₹{{ "%.2f"|format(item.unit_price) }}</span>
                    </div>
                    <div class="item-total">
                      <strong>Total: ₹{{ "%.2f"|format(item.total_price) }}</strong>
                    </div>
                  </div>
                </div>
                {% if not loop.last %}
                <hr>
                {% endif %}
                {% endfor %}
              </div>
            </div>

            <!-- Customer Notes -->
            {% if order.customer_note %}
            <div class="details-card" data-aos="fade-up">
              <div class="card-header" data-toggle="collapse">
                <h3>
                  <i class="bi bi-chat-left-text"></i>
                  Order Notes
                </h3>
                <i class="bi bi-chevron-down toggle-icon"></i>
              </div>
              <div class="card-body">
                <p>{{ order.customer_note }}</p>
              </div>
            </div>
            {% endif %}

            <!-- Action buttons -->
            <div class="action-area" data-aos="fade-up">
              <div class="row g-3">
                <div class="col-md-6">
                  <a href="{{ url_for('shop.products') }}" class="btn btn-primary w-100">
                    <i class="bi bi-arrow-left"></i>
                    Continue Shopping
                  </a>
                </div>
                <div class="col-md-6">
                  {% if current_user.is_authenticated %}
                  <a href="{{ url_for('shop.account', tab='orders') }}" class="btn btn-outline-primary w-100">
                    <span>View All Orders</span>
                    <i class="bi bi-arrow-right"></i>
                  </a>
                  {% else %}
                  <a href="{{ url_for('auth.login') }}" class="btn btn-outline-primary w-100">
                    <span>View Your Orders</span>
                    <i class="bi bi-arrow-right"></i>
                  </a>
                  {% endif %}
                </div>
              </div>
            </div>

            <!-- Recommended products (optional) -->
            <div class="recommended mt-5" data-aos="fade-up">
              <h3>You Might Also Like</h3>
              <div class="text-center mt-4">
                <p>Check out our latest products</p>
                <a href="{{ url_for('shop.products') }}" class="btn btn-primary">
                  Browse Products
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

  </section><!-- /Order Confirmation Section -->
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/order_confirmation.js') }}"></script>
{% endblock %}
