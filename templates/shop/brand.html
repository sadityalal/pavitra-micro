{% extends "base.html" %}

{% block title %}{{ brand.name }} - Pavitra Enterprises{% endblock %}
{% block description %}Shop {{ brand.name }} products at Pavitra Enterprises. Discover quality {{ brand.name }} items with great prices and fast shipping.{% endblock %}
{% block keywords %}{{ brand.name }}, {{ brand.name }} products, buy {{ brand.name }}, {{ brand.name }} brand{% endblock %}

{% block content %}
<!-- Page Title -->
<div class="page-title light-background">
  <div class="container d-lg-flex justify-content-between align-items-center py-3">
    <div class="d-flex align-items-center">
      {% if brand.logo_url %}
      <img src="{{ brand.logo_url }}" alt="{{ brand.name }} logo" class="brand-logo me-3" style="height: 50px; width: auto;">
      {% endif %}
      <div>
        <h1 class="mb-1">{{ brand.name }}</h1>
        {% if brand.is_indian_brand %}
        <span class="badge bg-success">Indian Brand</span>
        {% endif %}
      </div>
    </div>
    <nav class="breadcrumbs">
      <ol>
        <li><a href="{{ url_for('shop.index') }}">Home</a></li>
        <li><a href="{{ url_for('shop.products') }}">Brands</a></li>
        <li class="current">{{ brand.name }}</li>
      </ol>
    </nav>
  </div>
</div><!-- End Page Title -->

<!-- Brand Section -->
<section id="brand" class="brand section">
  <div class="container" data-aos="fade-up">
    
    <!-- Brand Header -->
    <div class="brand-header text-center mb-5">
      {% if brand.description %}
      <div class="brand-description mb-4">
        <p class="lead">{{ brand.description }}</p>
      </div>
      {% endif %}
      
      {% if brand.website_url %}
      <div class="brand-website mb-4">
        <a href="{{ brand.website_url }}" target="_blank" class="btn btn-outline-primary">
          <i class="bi bi-globe me-2"></i>Visit Official Website
        </a>
      </div>
      {% endif %}
    </div>

    <!-- Products Grid -->
    <div class="products-section">
      <div class="section-header d-flex justify-content-between align-items-center mb-4">
        <h2>{{ brand.name }} Products</h2>
        <div class="product-count">
          <span class="text-muted">{{ products|length }} product(s)</span>
        </div>
      </div>

      {% if products %}
      <div class="row">
        <!-- Filters Sidebar -->
        <div class="col-lg-3 mb-4">
          <div class="filter-sidebar card">
            <div class="card-body">
              <h5 class="card-title">Filters</h5>
              
              <!-- Price Filter -->
              <div class="filter-group mb-4">
                <h6 class="filter-title">Price Range</h6>
                <div class="price-inputs">
                  <div class="input-group mb-2">
                    <span class="input-group-text">Min</span>
                    <input type="number" class="form-control" id="minPrice" placeholder="0" min="0">
                  </div>
                  <div class="input-group">
                    <span class="input-group-text">Max</span>
                    <input type="number" class="form-control" id="maxPrice" placeholder="100000" min="0">
                  </div>
                </div>
                <button class="btn btn-sm btn-primary mt-2 w-100" onclick="BrandPage.applyPriceFilter()">Apply Price</button>
              </div>

              <!-- Stock Filter -->
              <div class="filter-group mb-4">
                <h6 class="filter-title">Availability</h6>
                <div class="form-check">
                  <input class="form-check-input stock-filter" type="checkbox" value="in_stock" id="stockInStock">
                  <label class="form-check-label" for="stockInStock">
                    In Stock
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input stock-filter" type="checkbox" value="out_of_stock" id="stockOutOfStock">
                  <label class="form-check-label" for="stockOutOfStock">
                    Out of Stock
                  </label>
                </div>
              </div>

              <!-- Clear Filters -->
              <button class="btn btn-outline-secondary w-100" onclick="BrandPage.clearAllFilters()">
                <i class="bi bi-arrow-clockwise me-2"></i>Clear Filters
              </button>
            </div>
          </div>

          <!-- Brand Info Card -->
          <div class="brand-info card mt-4">
            <div class="card-body">
              <h6 class="card-title">About {{ brand.name }}</h6>
              {% if brand.is_indian_brand %}
              <p class="small text-success mb-2">
                <i class="bi bi-check-circle me-1"></i>Indian Brand
              </p>
              {% endif %}
              {% if brand.brand_origin_country %}
              <p class="small text-muted mb-1">
                <i class="bi bi-geo-alt me-1"></i>Origin: {{ brand.brand_origin_country }}
              </p>
              {% endif %}
              <p class="small text-muted">
                {{ products|length }} products available
              </p>
            </div>
          </div>
        </div>

        <!-- Products Grid -->
        <div class="col-lg-9">
          <!-- Sorting and View Options -->
          <div class="products-toolbar mb-4">
            <div class="row align-items-center">
              <div class="col-md-6">
                <div class="sort-options">
                  <select class="form-select form-select-sm" onchange="BrandPage.sortProducts(this.value)">
                    <option value="name_asc">Sort by: Name A-Z</option>
                    <option value="name_desc">Sort by: Name Z-A</option>
                    <option value="price_asc">Sort by: Price Low to High</option>
                    <option value="price_desc">Sort by: Price High to Low</option>
                    <option value="newest">Sort by: Newest First</option>
                  </select>
                </div>
              </div>
              <div class="col-md-6 text-md-end">
                <div class="view-options">
                  <span class="text-muted small">
                    Showing <span id="showingCount">{{ products|length }}</span> of {{ products|length }} products
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- Products Grid -->
          <div class="row" id="productsGrid">
            {% for product in products %}
            <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-4 product-item"
                 data-price="{{ product.base_price }}"
                 data-name="{{ product.name|lower }}"
                 data-stock="{{ 'in_stock' if product.stock_quantity > 0 else 'out_of_stock' }}"
                 data-created="{{ product.created_at.timestamp() if product.created_at else 0 }}"
                 data-aos="fade-up" data-aos-delay="{{ loop.index * 50 }}">
              
              <div class="product-card card h-100">
                <!-- Product Image -->
                <div class="product-image position-relative">
                  <a href="{{ url_for('shop.product_detail', slug=product.slug) }}" class="product-image-link">
                    <img src="{{ product.main_image_url or url_for('static', filename='img/product/placeholder.jpg') }}" 
                         class="card-img-top" 
                         alt="{{ product.name }}"
                         loading="lazy">
                  </a>
                  
                  <!-- Product Badges -->
                  <div class="product-badges position-absolute top-0 start-0 p-2">
                    {% if product.is_featured %}
                    <span class="badge bg-warning mb-1">Featured</span>
                    {% endif %}
                    {% if product.is_on_sale and product.compare_price and product.compare_price > product.base_price %}
                    <span class="badge bg-danger">Sale</span>
                    {% endif %}
                    {% if product.stock_quantity == 0 %}
                    <span class="badge bg-secondary">Out of Stock</span>
                    {% elif product.stock_quantity <= product.low_stock_threshold %}
                    <span class="badge bg-warning">Low Stock</span>
                    {% endif %}
                  </div>

                  <!-- Quick Actions -->
                  <div class="product-actions position-absolute top-0 end-0 p-2">
                    <button class="btn btn-light btn-sm wishlist-btn {% if current_user.is_authenticated and product in current_user.wishlist_products %}active{% endif %}"
                            data-product-id="{{ product.id }}"
                            onclick="{% if current_user.is_authenticated %}ProductInteractions.addToWishlist('{{ product.id }}', this){% else %}ProductInteractions.showLoginAlert(event){% endif %}"
                            title="Add to Wishlist">
                      <i class="bi {% if current_user.is_authenticated and product in current_user.wishlist_products %}bi-heart-fill{% else %}bi-heart{% endif %}"></i>
                    </button>
                  </div>
                </div>

                <!-- Product Info -->
                <div class="card-body d-flex flex-column">
                  <h6 class="card-title">
                    <a href="{{ url_for('shop.product_detail', slug=product.slug) }}" class="text-decoration-none text-dark">
                      {{ product.name }}
                    </a>
                  </h6>
                  
                  <div class="product-meta mb-2">
                    <small class="text-muted">SKU: {{ product.sku }}</small>
                  </div>

                  <!-- Price -->
                  <div class="price-section mb-3">
                    {% if product.compare_price and product.compare_price > product.base_price %}
                    <div class="d-flex align-items-center">
                      <span class="current-price fw-bold text-primary fs-5">
                        {{ currency_symbol }}{{ "%.2f"|format(product.base_price) }}
                      </span>
                      <span class="original-price text-muted text-decoration-line-through ms-2">
                        {{ currency_symbol }}{{ "%.2f"|format(product.compare_price) }}
                      </span>
                      <span class="discount-percent text-danger small ms-2">
                        ({{ ((product.compare_price - product.base_price) / product.compare_price * 100)|round|int }}% off)
                      </span>
                    </div>
                    {% else %}
                    <span class="current-price fw-bold text-primary fs-5">
                      {{ currency_symbol }}{{ "%.2f"|format(product.base_price) }}
                    </span>
                    {% endif %}
                  </div>

                  <!-- Stock Status -->
                  <div class="stock-status mb-3">
                    {% if product.stock_quantity > 0 %}
                    <span class="badge bg-success">
                      <i class="bi bi-check-circle me-1"></i>In Stock
                    </span>
                    <small class="text-muted d-block mt-1">
                      {{ product.stock_quantity }} available
                    </small>
                    {% else %}
                    <span class="badge bg-secondary">
                      <i class="bi bi-x-circle me-1"></i>Out of Stock
                    </span>
                    {% endif %}
                  </div>

                  <!-- Add to Cart Button -->
                  <div class="mt-auto">
                    {% if product.stock_quantity > 0 %}
                    <button class="btn btn-primary w-100 add-to-cart-btn"
                            data-product-id="{{ product.id }}"
                            onclick="ProductInteractions.addToCart('{{ product.id }}', this)">
                      <i class="bi bi-cart-plus me-2"></i>Add to Cart
                    </button>
                    {% else %}
                    <button class="btn btn-outline-secondary w-100" disabled>
                      <i class="bi bi-envelope me-2"></i>Notify When Available
                    </button>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>

          <!-- Empty State (Hidden by default) -->
          <div class="empty-state text-center py-5" style="display: none;">
            <div class="empty-icon mb-3">
              <i class="bi bi-search display-1 text-muted"></i>
            </div>
            <h4 class="text-muted">No Products Found</h4>
            <p class="text-muted mb-4">Try adjusting your filters or search criteria.</p>
            <button class="btn btn-primary" onclick="BrandPage.clearAllFilters()">Clear All Filters</button>
          </div>
        </div>
      </div>
      {% else %}
      <!-- No Products State -->
      <div class="text-center py-5">
        <div class="empty-icon mb-4">
          <i class="bi bi-inbox display-1 text-muted"></i>
        </div>
        <h3 class="mb-3">No Products Available</h3>
        <p class="text-muted mb-4">There are currently no products available from {{ brand.name }}.</p>
        <a href="{{ url_for('shop.products') }}" class="btn btn-primary">
          <i class="bi bi-arrow-left me-2"></i>Browse All Products
        </a>
      </div>
      {% endif %}
    </div>
  </div>
</section><!-- /Brand Section -->
{% endblock %}

{% block scripts %}
<!-- Brand-specific JavaScript only -->
<script src="{{ url_for('static', filename='js/brand.js') }}"></script>
{% endblock %}